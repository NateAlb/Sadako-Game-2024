<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sadako's Curse - Web</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>

    <style>
        body { 
            margin: 0; 
            background: #1a1a1a; 
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            overflow: hidden; 
            color: white;
            font-family: 'Arial', sans-serif;
        }

        #game-wrapper {
            position: relative;
            border: 4px solid #6a0e00;
            box-shadow: 0 0 20px rgba(0,0,0,0.7);
        }

        #game-container {
            width: 576px;
            height: 324px;
            background-color: #000;
        }

        #controls-info {
            display: flex;
            justify-content: space-around;
            width: 576px;
            background: #000;
            padding: 10px 0;
            border-top: 2px solid #6a0e00;
            font-size: 13px;
        }

        .player-box {
            text-align: center;
            padding: 5px;
        }

        .player-box strong { color: #f7d100; }

        #footer-note {
            margin-top: 15px;
            font-size: 14px;
            color: #888;
            font-style: italic;
        }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <div id="game-container"></div>
        
        <div id="controls-info">
            <div class="player-box">
                <strong>PLAYER 1</strong><br>
                Mover: Setas<br>
                Atirar: ENTER
            </div>
            <div class="player-box">
                <strong>PLAYER 2</strong><br>
                Mover: WASD<br>
                Atirar: ESPAÇO
            </div>
            <div class="player-box">
                <strong>GERAL</strong><br>
                Menu: ESC<br>
                Confirmar: ENTER
            </div>
        </div>
    </div>

    <div id="footer-note">
        Baseado no projeto original de Nathan Albuquerque (2024).
    </div>

    <script>
        // --- CLASSES DO JOGO ---

        class Boot extends Phaser.Scene {
            constructor() { super('Boot'); }
            preload() {
                // Mensagens de debug no console
                this.load.on('loaderror', (file) => {
                    console.warn('Erro ao carregar recurso:', file.src);
                });

                // Caminhos (Ajuste se suas pastas no GitHub tiverem nomes diferentes)
                const imgPath = 'assets/images/';
                const sndPath = 'assets/audio/';

                // Imagens
                this.load.image('menu_bg', imgPath + 'MenuBg.png');
                this.load.image('solo_dupla_bg', imgPath + 'partida.png');
                this.load.image('creditos_bg', imgPath + 'InfoBg.png');
                this.load.image('ping_pong_bg', imgPath + 'PingPongBg.png');
                this.load.image('p1_left', imgPath + 'Player1Left.png');
                this.load.image('p1_right', imgPath + 'Player1Right.png');
                this.load.image('p1_shot', imgPath + 'Player1Shot.png');
                this.load.image('p2_left', imgPath + 'Player2Left.png');
                this.load.image('p2_right', imgPath + 'Player2Right.png');
                this.load.image('p2_shot', imgPath + 'Player2Shot.png');
                this.load.image('enemy', imgPath + 'Enemy1Left.png');
                this.load.image('ball', imgPath + 'BallPingPong.png');
                this.load.image('p1_pp', imgPath + 'Player1PingPong.png');
                this.load.image('p2_pp', imgPath + 'Player2PingPong.png');

                // Áudios
                this.load.audio('menu_music', sndPath + 'Menu.mp3');
                this.load.audio('solo_music', sndPath + 'partida_solo.mp3');
                this.load.audio('duo_music', sndPath + 'partida_duo.mp3');
                this.load.audio('credits_music', sndPath + 'InfoBg.mp3');
            }
            create() { this.scene.start('MainMenu'); }
        }

        class MainMenu extends Phaser.Scene {
            constructor() { super('MainMenu'); }
            create() {
                this.sound.stopAll();
                
                // SEGURANÇA: Só toca se o áudio existir no cache
                if (this.cache.audio.exists('menu_music')) {
                    this.sound.play('menu_music', { loop: true });
                }

                this.add.image(288, 162, 'menu_bg');
                
                const titleStyle = { font: 'bold 60px Arial', fill: '#6a0e00', stroke: '#000', strokeThickness: 5 };
                this.add.text(288, 70, "SADAKO'S CURSE", titleStyle).setOrigin(0.5);
                
                const options = ["MODO SOLO (1P)", "MODO DUO (2P)", "PING-PONG (2P)", "CRÉDITOS"];
                this.selected = 0;
                this.txtObjs = options.map((txt, i) => 
                    this.add.text(288, 180 + (i * 35), txt, { font: '22px Arial', fill: '#fff' }).setOrigin(0.5)
                );

                this.input.keyboard.on('keydown-DOWN', () => { 
                    this.selected = (this.selected + 1) % options.length; 
                    this.updateMenu(); 
                });
                this.input.keyboard.on('keydown-UP', () => { 
                    this.selected = (this.selected - 1 + options.length) % options.length; 
                    this.updateMenu(); 
                });
                
                this.input.keyboard.on('keydown-ENTER', () => {
                    if (this.selected === 0) this.scene.start('SoloMode');
                    else if (this.selected === 1) this.scene.start('DuoMode');
                    else if (this.selected === 2) this.scene.start('PingPongMode');
                    else if (this.selected === 3) this.scene.start('Credits');
                });

                this.updateMenu();
            }
            updateMenu() {
                this.txtObjs.forEach((obj, i) => {
                    obj.setStyle({ font: i === this.selected ? 'bold 28px Arial' : '22px Arial', fill: i === this.selected ? '#f7d100' : '#fff' });
                });
            }
        }

        // --- FUNÇÕES AUXILIARES ---
        function createShot(scene, player, texture, bulletsGroup) {
            let offset = player.dir === 'right' ? 45 : -45;
            let b = scene.physics.add.sprite(player.x + offset, player.y, texture);
            bulletsGroup.add(b);
            b.body.setAllowGravity(false);
            b.body.setVelocityX(player.dir === 'right' ? 800 : -800);
        }

        // --- CENAS DE JOGO ---

        class SoloMode extends Phaser.Scene {
            constructor() { super('SoloMode'); }
            create() {
                this.isGameOver = false;
                this.sound.stopAll();
                if (this.cache.audio.exists('solo_music')) this.sound.play('solo_music', { loop: true });
                
                this.add.image(288, 162, 'solo_dupla_bg');
                this.player = this.physics.add.sprite(50, 162, 'p1_right').setCollideWorldBounds(true);
                this.player.dir = 'right';
                this.player.lastShot = 0;
                
                this.bullets = this.physics.add.group();
                this.enemies = this.physics.add.group();
                this.kills = 0;
                this.timeLeft = 30;

                this.killText = this.add.text(20, 20, `Kills: 0`, { font: '20px Arial', fill: '#f7d100' });
                this.timeText = this.add.text(556, 20, `30s`, { font: '20px Arial', fill: '#fff' }).setOrigin(1, 0);

                this.cursors = this.input.keyboard.createCursorKeys();
                this.keyShoot = this.input.keyboard.addKey('ENTER');
                this.keyEsc = this.input.keyboard.addKey('ESC');

                this.time.addEvent({ delay: 1000, callback: () => { if(!this.isGameOver) this.timeLeft--; }, loop: true });
                this.time.addEvent({ delay: 400, callback: this.spawnEnemy, loop: true, callbackScope: this });

                this.physics.add.overlap(this.bullets, this.enemies, (bullet, enemy) => {
                    bullet.destroy(); enemy.destroy();
                    this.kills++;
                    this.killText.setText(`Kills: ${this.kills}`);
                });
            }

            update(time) {
                if (this.isGameOver) return;
                if (Phaser.Input.Keyboard.JustDown(this.keyEsc)) this.scene.start('MainMenu');
                if (this.timeLeft <= 0) return this.endGame(`FIM! Mortes: ${this.kills}`);

                this.player.setVelocity(0);
                if (this.cursors.up.isDown) this.player.setVelocityY(-300); 
                else if (this.cursors.down.isDown) this.player.setVelocityY(300);
                
                if (this.cursors.left.isDown) { 
                    this.player.setVelocityX(-300); 
                    this.player.setTexture('p1_left'); 
                    this.player.dir = 'left'; 
                } else if (this.cursors.right.isDown) { 
                    this.player.setVelocityX(300); 
                    this.player.setTexture('p1_right'); 
                    this.player.dir = 'right'; 
                }
                
                if (this.keyShoot.isDown && time > this.player.lastShot) {
                    createShot(this, this.player, 'p1_shot', this.bullets);
                    this.player.lastShot = time + 200;
                }
                this.timeText.setText(`${this.timeLeft}s`);
            }

            spawnEnemy() {
                if(this.isGameOver) return;
                let e = this.enemies.create(600, Phaser.Math.Between(50, 280), 'enemy');
                e.setVelocityX(Phaser.Math.Between(-200, -100));
            }

            endGame(msg) {
                this.isGameOver = true;
                this.physics.pause();
                this.add.text(288, 162, msg, { font: '32px Arial', fill: '#f7d100' }).setOrigin(0.5);
                this.time.delayedCall(3000, () => this.scene.start('MainMenu'));
            }
        }

        class DuoMode extends Phaser.Scene {
            constructor() { super('DuoMode'); }
            create() {
                this.isGameOver = false;
                this.sound.stopAll();
                if (this.cache.audio.exists('duo_music')) this.sound.play('duo_music', { loop: true });

                this.add.image(288, 162, 'solo_dupla_bg');
                this.p1 = this.physics.add.sprite(50, 100, 'p1_right').setCollideWorldBounds(true);
                this.p1.dir = 'right'; this.p1.lastShot = 0;
                
                this.p2 = this.physics.add.sprite(50, 220, 'p2_right').setCollideWorldBounds(true);
                this.p2.dir = 'right'; this.p2.lastShot = 0;

                this.bullets = this.physics.add.group();
                this.enemies = this.physics.add.group();
                
                this.k1 = this.input.keyboard.createCursorKeys();
                this.s1 = this.input.keyboard.addKey('ENTER');
                this.k2 = this.input.keyboard.addKeys({up:'W', down:'S', left:'A', right:'D', shoot:'SPACE'});
                this.keyEsc = this.input.keyboard.addKey('ESC');

                this.time.addEvent({ delay: 500, callback: this.spawnEnemy, loop: true, callbackScope: this });
                this.physics.add.overlap(this.bullets, this.enemies, (b, e) => { b.destroy(); e.destroy(); });
            }

            update(time) {
                if (Phaser.Input.Keyboard.JustDown(this.keyEsc)) this.scene.start('MainMenu');
                this.moveP(this.p1, this.k1, this.s1, 'p1_left', 'p1_right', 'p1_shot', time);
                this.moveP(this.p2, {up:this.k2.up, down:this.k2.down, left:this.k2.left, right:this.k2.right}, this.k2.shoot, 'p2_left', 'p2_right', 'p2_shot', time);
            }

            moveP(p, k, s, tL, tR, sImg, time) {
                p.setVelocity(0);
                if(k.up.isDown) p.setVelocityY(-250); else if(k.down.isDown) p.setVelocityY(250);
                if(k.left.isDown) { p.setVelocityX(-250); p.setTexture(tL); p.dir='left'; } 
                else if(k.right.isDown) { p.setVelocityX(250); p.setTexture(tR); p.dir='right'; }
                if(s.isDown && time > p.lastShot) {
                    createShot(this, p, sImg, this.bullets);
                    p.lastShot = time + 250;
                }
            }

            spawnEnemy() {
                let e = this.enemies.create(600, Phaser.Math.Between(50, 280), 'enemy');
                e.setVelocityX(-150);
            }
        }

        class PingPongMode extends Phaser.Scene {
            constructor() { super('PingPongMode'); }
            create() {
                this.add.image(288, 162, 'ping_pong_bg');
                this.p1 = this.physics.add.sprite(30, 162, 'p1_pp').setImmovable(true).setCollideWorldBounds(true);
                this.p2 = this.physics.add.sprite(546, 162, 'p2_pp').setImmovable(true).setCollideWorldBounds(true);
                this.ball = this.physics.add.sprite(288, 162, 'ball').setBounce(1).setCollideWorldBounds(true);
                this.ball.setVelocity(200, 200);
                
                this.physics.add.collider(this.ball, [this.p1, this.p2]);
                this.k1 = this.input.keyboard.addKeys({up:'W', down:'S'});
                this.k2 = this.input.keyboard.createCursorKeys();
                this.keyEsc = this.input.keyboard.addKey('ESC');
            }
            update() {
                if (Phaser.Input.Keyboard.JustDown(this.keyEsc)) this.scene.start('MainMenu');
                this.p1.setVelocityY(this.k1.up.isDown ? -300 : this.k1.down.isDown ? 300 : 0);
                this.p2.setVelocityY(this.k2.up.isDown ? -300 : this.k2.down.isDown ? 300 : 0);
                if(this.ball.x < 5 || this.ball.x > 570) this.ball.setPosition(288, 162);
            }
        }

        class Credits extends Phaser.Scene {
            constructor() { super('Credits'); }
            create() {
                this.add.image(288, 162, 'creditos_bg');
                this.add.text(288, 150, "Desenvolvido por:\nNathan Albuquerque", { font: '28px Arial', fill: '#fff', align: 'center' }).setOrigin(0.5);
                this.add.text(288, 280, "ESC para voltar", { font: '18px Arial', fill: '#f7d100' }).setOrigin(0.5);
                this.input.keyboard.on('keydown-ESC', () => this.scene.start('MainMenu'));
            }
        }

        // --- CONFIGURAÇÃO FINAL ---
        const config = {
            type: Phaser.AUTO,
            width: 576,
            height: 324,
            parent: 'game-container',
            physics: { default: 'arcade', arcade: { debug: false } },
            scene: [Boot, MainMenu, SoloMode, DuoMode, PingPongMode, Credits]
        };
        
        new Phaser.Game(config);
    </script>
</body>
</html>
